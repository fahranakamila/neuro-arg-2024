<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LAYER 2: EYE OF THE BEHOLDER</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Courier New', monospace;
        }
        
        body {
            background: #0a0a0a;
            color: #00ff00;
            min-height: 100vh;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            padding: 20px;
            border-bottom: 1px solid #00ff00;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 2rem;
            text-shadow: 0 0 10px #00ff00;
            margin-bottom: 10px;
        }
        
        .terminal {
            background: #111;
            border: 1px solid #333;
            border-radius: 5px;
            padding: 20px;
            margin: 20px auto;
            max-width: 800px;
        }
        
        .terminal-line {
            margin: 10px 0;
            color: #00ff00;
        }
        
        .terminal-line.system {
            color: #5555ff;
        }
        
        .terminal-line.success {
            color: #55ff55;
        }
        
        .terminal-line.error {
            color: #ff5555;
        }
        
        .puzzle-container {
            background: #1a1a1a;
            border: 1px solid #00ff00;
            padding: 30px;
            margin: 30px auto;
            max-width: 800px;
            border-radius: 10px;
            text-align: center;
        }
        
        .eye-target {
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, #ff0000, #990000);
            border-radius: 50%;
            margin: 30px auto;
            position: relative;
            animation: pulse 2s infinite;
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.7);
            cursor: pointer;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .webcam-container {
            position: relative;
            width: 640px;
            height: 480px;
            margin: 20px auto;
            border: 3px solid #00ff00;
            border-radius: 10px;
            overflow: hidden;
            display: none;
        }
        
        #webcam {
            width: 100%;
            height: 100%;
            transform: scaleX(-1); /* Mirror effect */
        }
        
        .gaze-dot {
            position: absolute;
            width: 20px;
            height: 20px;
            background: #00ffff;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            display: none;
        }
        
        .focus-meter {
            width: 100%;
            height: 20px;
            background: #333;
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
            border: 1px solid #00ff00;
        }
        
        .focus-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff0000, #ffff00, #00ff00);
            width: 0%;
            transition: width 0.3s;
        }
        
        .focus-text {
            font-size: 1.2rem;
            margin: 10px 0;
        }
        
        button {
            background: #003300;
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 12px 24px;
            cursor: pointer;
            border-radius: 5px;
            font-size: 1.1rem;
            margin: 10px;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #005500;
            box-shadow: 0 0 15px #00ff00;
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .hidden {
            display: none;
        }
        
        .secret-reveal {
            background: #222;
            padding: 20px;
            border-radius: 10px;
            margin: 30px auto;
            max-width: 600px;
            border: 2px dashed #ff55ff;
        }
        
        #coordinates {
            font-family: monospace;
            font-size: 1.3rem;
            color: #ff55ff;
            background: #111;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            letter-spacing: 2px;
        }
        
        .coordinates-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }
        
        .coordinate {
            background: #222;
            padding: 10px 20px;
            border-radius: 5px;
            border: 1px solid #00ffff;
        }
        
        .coordinate .label {
            color: #00ffff;
            font-size: 0.9rem;
        }
        
        .coordinate .value {
            font-size: 1.3rem;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üëÅÔ∏è LAYER 2: EYE OF THE BEHOLDER</h1>
        <p>Neural Access Level: 2 | User: Observer</p>
        <p>Secret Code: <span id="userCode">NEURO-ARG-2024-ALPHA</span></p>
    </div>
    
    <div class="terminal">
        <div class="terminal-line system">> SYSTEM: Access granted with code verification</div>
        <div class="terminal-line system">> CHALLENGE: Eye focus calibration required</div>
        <div class="terminal-line">> OBJECTIVE: Stare at the red target for 10 seconds</div>
        <div class="terminal-line">> WEBCAM: Required for gaze detection</div>
    </div>
    
    <div class="puzzle-container">
        <h2>üëÅÔ∏è EYE FOCUS CALIBRATION</h2>
        <p>Your focus will be tested. Webcam access is required.</p>
        
        <div class="eye-target" id="eyeTarget">
            <div class="gaze-dot" id="gazeDot"></div>
        </div>
        
        <div class="focus-meter">
            <div class="focus-fill" id="focusFill"></div>
        </div>
        
        <div class="focus-text" id="focusText">
            üî¥ Focus Required: 0.0s / 10.0s
        </div>
        
        <div class="coordinates-container">
            <div class="coordinate">
                <div class="label">X Coordinate</div>
                <div class="value" id="coordX">---</div>
            </div>
            <div class="coordinate">
                <div class="label">Y Coordinate</div>
                <div class="value" id="coordY">---</div>
            </div>
            <div class="coordinate">
                <div class="label">Focus Score</div>
                <div class="value" id="focusScore">0%</div>
            </div>
        </div>
        
        <button id="startBtn">üé• START WEBCAM CALIBRATION</button>
        <button id="fakeBtn" onclick="useFakeDetection()">ü§ñ USE FAKE DETECTION (No Webcam)</button>
        
        <div class="webcam-container" id="webcamContainer">
            <video id="webcam" autoplay playsinline></video>
        </div>
    </div>
    
    <div id="successSection" class="hidden">
        <div class="secret-reveal">
            <h2>üéØ FOCUS CALIBRATION COMPLETE!</h2>
            <div class="terminal-line success">> EYE TRACKING: Calibration successful</div>
            <div class="terminal-line success">> NEURAL PATTERN: Stabilized</div>
            
            <p>Your gaze coordinates have been recorded:</p>
            <div id="coordinates">X: [CALCULATED] Y: [CALCULATED]</div>
            
            <p>Use these coordinates for the next puzzle:</p>
            <div class="terminal-line">
                > NEXT LOCATION: github.com/neuro-arg/‚ñà-‚ñà-‚ñà-‚ñà
            </div>
            
            <button onclick="showFinalMessage()">üîê REVEAL FINAL COORDINATES</button>
        </div>
    </div>
    
    <div id="finalMessage" class="hidden">
        <div class="puzzle-container" style="border-color: #ff55ff;">
            <h2>üåü COORDINATES DECRYPTED</h2>
            <div class="terminal-line success">> FINAL COORDINATES: 40.7128, -74.0060</div>
            <div class="terminal-line">> LOCATION: New York City</div>
            <div class="terminal-line">> NEXT CLUE: Search for "neural nexus" at these coordinates</div>
            
            <p>Congratulations! You've completed Layer 2.</p>
            <button onclick="goToLayer3()">üöÄ CONTINUE TO LAYER 3</button>
        </div>
    </div>
    
    <script>
        // State variables
        let isWebcamActive = false;
        let focusTime = 0;
        let focusInterval;
        let gazeX = 0;
        let gazeY = 0;
        let isFakeMode = false;
        
        // DOM Elements
        const startBtn = document.getElementById('startBtn');
        const fakeBtn = document.getElementById('fakeBtn');
        const webcamContainer = document.getElementById('webcamContainer');
        const webcamVideo = document.getElementById('webcam');
        const gazeDot = document.getElementById('gazeDot');
        const focusFill = document.getElementById('focusFill');
        const focusText = document.getElementById('focusText');
        const eyeTarget = document.getElementById('eyeTarget');
        const coordX = document.getElementById('coordX');
        const coordY = document.getElementById('coordY');
        const focusScore = document.getElementById('focusScore');
        const successSection = document.getElementById('successSection');
        const finalMessage = document.getElementById('finalMessage');
        const userCode = document.getElementById('userCode');
        
        // Get secret code from URL or localStorage
        function getSecretCode() {
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code') || localStorage.getItem('neuroArgCode') || 'NEURO-ARG-2024-ALPHA';
            userCode.textContent = code;
            return code;
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            const code = getSecretCode();
            addTerminalLog(`> USER CODE VERIFIED: ${code}`);
            
            // Verify code (simple check)
            if (!code.includes('NEURO-ARG')) {
                addTerminalLog(`> ERROR: Invalid access code`, 'error');
                startBtn.disabled = true;
            }
        });
        
        // Terminal log function
        function addTerminalLog(message, type = '') {
            const terminal = document.querySelector('.terminal');
            const line = document.createElement('div');
            line.className = `terminal-line ${type}`;
            line.textContent = `> ${message}`;
            terminal.appendChild(line);
            terminal.scrollTop = terminal.scrollHeight;
        }
        
        // Start webcam
        async function startWebcam() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        width: { ideal: 640 },
                        height: { ideal: 480 },
                        facingMode: 'user'
                    }
                });
                
                webcamVideo.srcObject = stream;
                webcamContainer.style.display = 'block';
                isWebcamActive = true;
                
                startBtn.textContent = 'üëÅÔ∏è TRACKING ACTIVE';
                startBtn.disabled = true;
                fakeBtn.disabled = true;
                
                addTerminalLog('Webcam activated successfully', 'success');
                addTerminalLog('Starting gaze simulation...', 'system');
                
                // Start fake gaze tracking (since we don't have real eye tracking)
                startFakeGazeTracking();
                startFocusChallenge();
                
            } catch (error) {
                addTerminalLog(`Webcam error: ${error.message}`, 'error');
                addTerminalLog('Using fake detection mode instead', 'system');
                useFakeDetection();
            }
        }
        
        // Fake gaze tracking (mouse movement simulation)
        function startFakeGazeTracking() {
            gazeDot.style.display = 'block';
            
            document.addEventListener('mousemove', function(e) {
                if (!isWebcamActive && !isFakeMode) return;
                
                // Update gaze dot position
                gazeX = e.clientX;
                gazeY = e.clientY;
                
                gazeDot.style.left = gazeX + 'px';
                gazeDot.style.top = gazeY + 'px';
                
                // Update coordinates display
                updateCoordinates(gazeX, gazeY);
                
                // Check if gaze is on target
                checkGazeOnTarget(gazeX, gazeY);
            });
            
            addTerminalLog('Gaze tracking initialized', 'system');
        }
        
        // Update coordinate display
        function updateCoordinates(x, y) {
            coordX.textContent = Math.floor(x);
            coordY.textContent = Math.floor(y);
        }
        
        // Check if gaze is on target
        function checkGazeOnTarget(x, y) {
            const targetRect = eyeTarget.getBoundingClientRect();
            const targetCenterX = targetRect.left + targetRect.width / 2;
            const targetCenterY = targetRect.top + targetRect.height / 2;
            
            const distance = Math.sqrt(
                Math.pow(x - targetCenterX, 2) + 
                Math.pow(y - targetCenterY, 2)
            );
            
            const isOnTarget = distance < targetRect.width / 2;
            const score = Math.max(0, 100 - Math.floor(distance / 5));
            
            focusScore.textContent = isOnTarget ? '100%' : score + '%';
            
            return isOnTarget;
        }
        
        // Start focus challenge
        function startFocusChallenge() {
            focusTime = 0;
            const totalTime = 10.0; // 10 seconds
            
            focusInterval = setInterval(() => {
                // Simulate gaze on target (in real app, use actual detection)
                const isOnTarget = isFakeMode ? true : checkGazeOnTarget(gazeX, gazeY);
                
                if (isOnTarget) {
                    focusTime += 0.1;
                    focusFill.style.width = (focusTime / totalTime * 100) + '%';
                    focusText.innerHTML = `üéØ FOCUSED: ${focusTime.toFixed(1)}s / ${totalTime}s`;
                    
                    // Change color based on progress
                    if (focusTime > 7) {
                        focusFill.style.background = 'linear-gradient(90deg, #00ff00, #00aa00)';
                        focusText.style.color = '#55ff55';
                    } else if (focusTime > 3) {
                        focusFill.style.background = 'linear-gradient(90deg, #ffff00, #ffaa00)';
                        focusText.style.color = '#ffff55';
                    }
                    
                    // Check if completed
                    if (focusTime >= totalTime) {
                        clearInterval(focusInterval);
                        completeFocusChallenge();
                    }
                } else {
                    focusText.innerHTML = `üî¥ FOCUS REQUIRED: ${focusTime.toFixed(1)}s / ${totalTime}s`;
                }
            }, 100);
        }
        
        // Complete focus challenge
        function completeFocusChallenge() {
            addTerminalLog('Focus calibration complete!', 'success');
            addTerminalLog('Neural pattern stabilized', 'success');
            
            // Calculate "coordinates" based on gaze pattern
            const finalX = Math.floor(gazeX / 10) * 10;
            const finalY = Math.floor(gazeY / 10) * 10;
            
            document.getElementById('coordinates').textContent = 
                `X: ${finalX} Y: ${finalY}`;
            
            // Show success section
            successSection.classList.remove('hidden');
            
            // Save to localStorage
            localStorage.setItem('neuroArgGazeX', finalX);
            localStorage.setItem('neuroArgGazeY', finalY);
        }
        
        // Fake detection mode (for users without webcam)
        function useFakeDetection() {
            isFakeMode = true;
            startBtn.disabled = true;
            fakeBtn.disabled = true;
            
            addTerminalLog('Using simulated gaze detection', 'system');
            addTerminalLog('Move your cursor to the red target', 'system');
            
            // Start fake gaze tracking
            gazeDot.style.display = 'block';
            gazeDot.style.background = '#ff00ff';
            
            // Set initial position
            gazeX = window.innerWidth / 2;
            gazeY = window.innerHeight / 2;
            gazeDot.style.left = gazeX + 'px';
            gazeDot.style.top = gazeY + 'px';
            
            startFakeGazeTracking();
            startFocusChallenge();
        }
        
        // Show final message
        function showFinalMessage() {
            successSection.classList.add('hidden');
            finalMessage.classList.remove('hidden');
            
            addTerminalLog('Final coordinates decrypted', 'success');
            addTerminalLog('Preparing Layer 3 access...', 'system');
        }
        
        function goToLayer3() {
            // Get coordinates from localStorage
            const x = localStorage.getItem('neuroArgGazeX') || '760';
            const y = localStorage.getItem('neuroArgGazeY') || '430';
    
        // Redirect to Layer 3
        window.location.href = 'layer3.html?x=' + x + '&y=' + y;
        }
        
        // Event listeners
        startBtn.addEventListener('click', startWebcam);
        
        // Add some initial terminal logs
        setTimeout(() => {
            addTerminalLog('Eye tracking system initialized', 'system');
        }, 1000);
        
        setTimeout(() => {
            addTerminalLog('Waiting for user calibration...', '');
        }, 2000);
    </script>
</body>
</html>